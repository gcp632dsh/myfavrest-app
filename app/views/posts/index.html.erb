<div class="container">
    <div class="row">
        <div class="communitydtl col-2">
            <div>
            </div>
        </div>
        <div class="communityindex col-10">
            <div class="searchform container">
                <%= search_form_for @search do |f| %>
                    <div class="row">
                        <div class="form-group cond1 col-sm-5 m-0">
                            <%= f.search_field :title_or_user_username_cont, class:"form-control" ,placeholder: "店名またはユーザー名で探す "  %>
                        </div>
                        <div class="form-group cond2 col-sm-4 m-0">
                            <%= f.collection_select( :prefecture_code_eq_any, JpPrefecture::Prefecture.all, :code, :name, {include_blank: '都道府県を選択してください'}, {class: "form-control"}) %>
                        </div>
                        <div class="form-group cond3 col-sm-3 m-0">
                            <%= f.select( :sorts, {'並び替え': 'updated_at desc', 'いいねの多い順': 'likes_count desc','日付の新しい順': 'updated_at desc', '日付の古い順': 'updated_at asc' }, {},{class: "form-control"}) %>
                        </div>
                        <%= f.hidden_field :community_id, value: @post.community.id %>
                        <div class="form-group cond_sbtn col-sm-2 mt-2">
                            <%= f.submit "検索", class: 'sbtn' %>
                        </div>
                    </div>
                <% end %>
            </div>
            <!-- 店一覧 START -->
            <div class="container shops">
                <div class="row">
                    <% @posts.each do |post| %>
                        <div class = "col-sm-12 col-md-12 col-lg-4 mb-5">
                            <!-- カード START -->
                            <div class="card">
                                <div class="category-tag m-0"><% post.rest_type %>居酒屋</div>
                                <% if post.image.attached? %>
                                    <%= image_tag post.image, class:"card-img-top" %>
                                <% else %>
                                    <%= image_tag ("no_image.png"), class:"card-img-top" %>
                                <% end %>
                                <div class="card-body">
                                    <p class="card-title"><%= post.title %></p>
                                    <div class="card-text">
                                        <span>
                                            <% if post.prefecture_code.present? %>
                                                <%= post.prefecture.name %>
                                            <% end %>
                                        </span><br>
                                        <span><%= post.area %></span>
                                        <span><%= link_to "詳細", community_post_path(post.community,post), class: "card-link" %></span><br>
                                        <span><%= post.updated_at.strftime("%Y/%m/%d") %></span><br>
                                        <span><i class="fas fa-comment-alt"></i> <%= post.comments.count %></span>
                                    </div>
                                    <div class="text-right" id="likes_buttons_<%= post.id %>">
                                        <%= render partial: 'shared/like', locals: {community: post.community, post: post} %>
                                    </div>
                                    <!-- 後で詳細画面に移動 -->
                                    <div class="edit-delete">
                                        <% if post.user == current_user %>
                                            <%= link_to edit_community_post_path(post.community,post) do %>
                                                <i class="material-icons">edit</i>
                                            <% end %>
                                            <%= link_to community_post_path(post.community,post), data: { confirm: "本当に削除しますか?" }, method: :delete do %>
                                                <i class="material-icons">delete</i>
                                            <% end %>
                                        <% end %>
                                    </div>
                                    <!-- 後で詳細画面に移動 -->
                                </div>
                            </div>
                            <!-- カード END -->
                        </div>
                    <% end %>
                </div>
                <div class="center">
                    <%= paginate @posts %>
                </div>
            </div>
            <!-- 店一覧 END -->
        </div>
    </div>
</div>
<div class="d-none d-md-block">
    <%= link_to '新規投稿', new_community_post_path, class: 'new-btn' %>
</div>